FROM mysql:8.0.33-debian as mysql

# Install dependencies
RUN apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y wget unzip python3 python3-pip

# Set the MySQL root password
ENV MYSQL_ROOT_PASSWORD=root

# Copy the SQL initialization script
COPY init2.sql /docker-entrypoint-initdb.d/

# Copy the Bash script and Python script
COPY scripts/pull_and_unzip.sh /opt/src/scripts/pull_and_unzip.sh
COPY scripts/csv_to_sql.py /opt/src/scripts/csv_to_sql.py

# Install Python dependencies
COPY requirements.txt .
RUN pip3 install -r requirements.txt

# Make the Bash script executable
RUN chmod +x /opt/src/scripts/pull_and_unzip.sh

# Run the Bash script
RUN /opt/src/scripts/pull_and_unzip.sh

#CMD ["python3", "/opt/src/scripts/csv_to_sql.py"]


# Expose the MySQL port
EXPOSE 3306

# Define the volume mount
VOLUME ["/var/lib/mysql" ]


FROM pythonl